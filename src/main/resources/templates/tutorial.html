<!DOCTYPE html>
<html>
<head>
    <title>可回放拖放示例</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .flowchart-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
        }
        .step {
            border: 2px solid #007bff;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            width: 80%;
            text-align: center;
        }
        .decision {
            border: 2px solid #ffc107;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            width: 80%;
            text-align: center;
        }
        .arrow {
            text-align: center;
            margin: -10px 0;
        }
        .arrow::before {
            content: '↓';
            font-size: 20px;
        }
        .branch-container {
            display: flex;
            justify-content: space-around;
            width: 100%;
        }
        .branch {
            width: 40%;
        }
    </style>
</head>

<body>
<h1>Welcome to Achy Teepee!</h1>

<p>The post office business just isn’t cutting it, so you look to other ventures. Why not open a restaurant? Instead of starting from scratch, you decide to start a franchise. While researching, you notice a popular fine dining chain by the name of Achy Teepee, known for their quick and reliable service. A couple days and signatures later, and you now own your very own Achy Teepee!</p>

<h2>Training Your Staff</h2>

<p>However, you now have to train your staff. The standard process for dealing with each customer is as follows:</p>
<ol>
    <li>The customer places an order to the server.</li>
    <li>The server takes the order and sends it to the kitchen.</li>
    <li>If the order is not available, the kitchen sends the server back to the customer to inform them. Otherwise, the kitchen makes the order and the server brings it to the customer.</li>
</ol>

<p>Since Achy Teepee is a chain, you will be provided with the menu items and ingredients. All you need to worry about are the logistics of customer service.</p>

<h2>HTTP Protocol</h2>

<p>Web browsers work in a similar way to restaurants. When you navigate to a website in your browser, your browser (the client) will communicate with a web server to retrieve the requested website. The HTTP protocol deals with requests as follows:</p>
<ol>
    <li>The client sends a request to the server.</li>
    <li>The server receives and processes the request.</li>
    <li>If something goes wrong, the server will respond with a failed status code. Otherwise, the server will respond with the desired information.</li>
</ol>

<p>We have provided you with the code for the web server already. All you have to do is implement the HTTP protocol logic to generate a working website.</p>



<div class="container mt-5">
    <div class="row">
        <!-- 拖动源和目标 -->
        <div class="col-4">
            <div id="origin" ondrop="drop(event)" ondragover="allowDrop(event)" class="bg-light border p-5">
                <div id="drag1" draggable="true" ondragstart="drag(event)" class="bg-primary text-white p-2">
                    <!-- Code Block 1: Client Sends a Request -->
                    <div class="code-block">
                        <p>HTTP/1.1 404<br>
                            Content-Type: text/html<br>
                            <br>
                        </p>
                        <code>

                        </code>
                    </div>

                </div>
                <div id="drag2" draggable="true" ondragstart="drag(event)" class="bg-success text-white p-2">
                    <!-- Code Block 2: Server Receives and Processes the Request -->
                    <div class="code-block">
                        <p>
                            HTTP/1.1 200<br>
                            Content-Type: text/html<br>
                        </p>

                        <code>

                        </code>
                    </div>

                </div>
                <div id="drag3" draggable="true" ondragstart="drag(event)" class="bg-info text-white p-2">
                    <p>GET /index.html HTTP/1.1<br>
                        Host: www.example.com</p>

                </div>
                <div id="drag4" draggable="true" ondragstart="drag(event)" class="bg-secondary text-white p-2">
                    <p>if (request.isValid()) {<br>
                        response = processRequest(request);<br>
                        } else {<br>
                        response = errorResponse("Invalid Request");<br>
                        }</p>
                </div>
            </div>
        </div>

        <!-- 拖放目标 -->
        <div class="col-8">
            <div id="drop1" ondrop="drop(event)" ondragover="allowDrop(event)" class="bg-light border p-5">Placement Area 1<br>
                <p><b>Client Sends a Request:</b> The client uses an HTTP method (like GET or POST) to send a request to the server.</p>
            </div>
            <div id="drop2" ondrop="drop(event)" ondragover="allowDrop(event)" class="bg-light border p-5">Placement Area 2<br>
                <p><b>Server Receives and Processes the Request:</b> The server analyzes the request and prepares a response.</p>
            </div>
            <div id="drop3" ondrop="drop(event)" ondragover="allowDrop(event)" class="bg-light border p-5">Placement Area 3<br>
                <p><b>Server Responds with a Failed Status Code:</b> If there's an issue with the request, the server returns an error status code.</p>
            </div>
            <div id="drop4" ondrop="drop(event)" ondragover="allowDrop(event)" class="bg-light border p-5">Placement Area 4<br>
                <p><b>Server Responds with the Desired Information:</b> If the request is successful, the server returns the requested data.</p>
            </div>
        </div>
        <!-- 成功消息显示区域 -->
        <div id="successMessage" style="display: none; margin-top: 20px;" class="alert alert-success">
            You Passed the Test!
        </div>
        <!-- 失败消息显示区域 -->
        <div id="failureMessage" style="display: none; margin-top: 20px;" class="alert alert-danger">
            Code writing failed, please check whether the drag and drop position is correct.
        </div>



        <div class="flowchart-container">
            <div class="step">Client Sends a Request:<br>The client uses an HTTP method (like GET or POST) to send a request to the server.</div>
            <div class="arrow"></div>
            <div class="step">Server Receives and Processes the Request:<br>The server analyzes the request and prepares a response.</div>
            <div class="arrow"></div>
            <div class="decision">Did the server process the request successfully?</div>
            <div class="branch-container">
                <div class="branch">
                    <div class="arrow">Yes</div>
                    <div class="step">Server Responds with the Desired Information:<br>If the request is successful, the server returns the requested data.</div>
                </div>
                <div class="branch">
                    <div class="arrow">No</div>
                    <div class="step">Server Responds with a Failed Status Code:<br>If there's an issue with the request, the server returns an error status code.</div>
                </div>
            </div>
        </div>
    </div>

</div>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script src="static/css/bootstrap.css"></script>
</body>
</html>



<script>

    const placementTracker = {
        'drag1': false,
        'drag2': false,
        'drag3': false,
        'drag4': false
    };


    function drop(ev) {
        ev.preventDefault();
        var data = ev.dataTransfer.getData("text");
        var draggedElement = document.getElementById(data);
        var dropTarget = ev.target;

        // 检查放置目标是否为放置区域本身或已放置的文本框
        if (dropTarget.className.includes('bg-light') || dropTarget.className.includes('text-white')) {
            // 如果目标是放置区域或文本框的父级是放置区域，则添加元素
            if (dropTarget.className.includes('bg-light')) {
                dropTarget.appendChild(draggedElement);
                // 更新拖动元素的放置状态
                updatePlacementTracker(draggedElement.id, dropTarget.id);
            } else {
                // 如果目标是文本框，则找到其父级放置区域，并添加元素
                var parentDropArea = dropTarget.closest('.bg-light');
                if (parentDropArea) {
                    parentDropArea.appendChild(draggedElement);
                    // 更新拖动元素的放置状态
                    updatePlacementTracker(draggedElement.id, parentDropArea.id);
                }
            }
        } else if (dropTarget.id === "origin") {
            // 如果目标是原始位置，则直接放回
            dropTarget.appendChild(draggedElement);
            // 如果元素被拖回起始位置，更新其状态为未放置
            placementTracker[draggedElement.id] = false;
        }
    }

    function updatePlacementTracker(draggedId, dropTargetId) {
        // 根据拖动元素和放置区域的ID更新状态
        if ((draggedId === 'drag1' && dropTargetId === 'drop3') ||
            (draggedId === 'drag2' && dropTargetId === 'drop4') ||
            (draggedId === 'drag3' && dropTargetId === 'drop1') ||
            (draggedId === 'drag4' && dropTargetId === 'drop2')) {
            placementTracker[draggedId] = true;
        } else {
            placementTracker[draggedId] = false;
        }

        // 检查所有元素是否都被正确放置
        checkAllPlacedCorrectly();
    }

    function checkAllPlacedCorrectly() {
        var successMessage = document.getElementById('successMessage');
        if (placementTracker.drag1 && placementTracker.drag2 && placementTracker.drag3 && placementTracker.drag4) {
            alert('You passed the test!');
            successMessage.style.display = 'block';
            failureMessage.style.display = 'none';
        } else {
            // 如果不满足，确保消息不显示
            successMessage.style.display = 'none';
            failureMessage.style.display = 'block';
        }
    }

    function allowDrop(ev) {
        ev.preventDefault(); // 允许放置
    }

    function drag(ev) {
        ev.dataTransfer.setData("text", ev.target.id); // 指定拖动数据
    }



    // function drop(ev) {
    //     ev.preventDefault();
    //     var data = ev.dataTransfer.getData("text");
    //     var draggedElement = document.getElementById(data);
    //     var dropTarget = ev.target;
    //
    //     // 检查放置目标是否为放置区域本身或已放置的文本框
    //     if (dropTarget.className.includes('bg-light') || dropTarget.className.includes('text-white')) {
    //         // 如果目标是放置区域或文本框的父级是放置区域，则添加元素
    //         if (dropTarget.className.includes('bg-light')) {
    //             dropTarget.appendChild(draggedElement);
    //         } else {
    //             // 如果目标是文本框，则找到其父级放置区域，并添加元素
    //             var parentDropArea = dropTarget.closest('.bg-light');
    //             if (parentDropArea) {
    //                 parentDropArea.appendChild(draggedElement);
    //             }
    //         }
    //     } else if (dropTarget.id === "origin") {
    //         // 如果目标是原始位置，则直接放回
    //         dropTarget.appendChild(draggedElement);
    //     }
    // }

</script>



<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</body>
</html>
